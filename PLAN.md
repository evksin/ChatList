# План реализации программы ChatList

## Этап 1: Подготовка проекта и структуры

- [x] Создать структуру проекта (папки для модулей, если нужно)
- [x] Настроить requirements.txt с необходимыми зависимостями:
  - PyQt5 (GUI)
  - requests или httpx (HTTP-запросы)
  - python-dotenv (для работы с .env файлом)
  - sqlite3 (встроен в Python)
- [x] Создать файл .env.example с примером структуры для API-ключей
- [x] Создать .gitignore для исключения .env и других служебных файлов

## Этап 2: База данных (db.py)

- [x] Создать модуль db.py с функциями для работы с SQLite
- [x] Реализовать инициализацию базы данных (создание таблиц):
  - prompts (id, date, prompt, tags)
  - models (id, name, api_url, api_id, is_active)
  - results (id, prompt_id, model_id, response, date, selected)
  - settings (key, value)
- [x] Реализовать CRUD операции для каждой таблицы:
  - prompts: create, read, update, delete, search, sort
  - models: create, read, update, delete, get_active_models
  - results: create, read, update, delete, search, sort
  - settings: get, set
- [x] Добавить функции для поиска и сортировки во всех таблицах

## Этап 3: Работа с API (network.py)

- [x] Создать модуль network.py для отправки HTTP-запросов
- [x] Реализовать базовый класс или функции для работы с API разных провайдеров:
  - OpenAI API
  - DeepSeek API
  - Groq API
  - OpenRouter API
  - (возможность расширения для других провайдеров)
- [x] Реализовать обработку ошибок и таймаутов
- [x] Добавить логирование запросов и ответов
- [x] Реализовать асинхронную отправку запросов (опционально, для ускорения)

## Этап 4: Логика работы с моделями (models.py)

- [x] Создать модуль models.py
- [x] Реализовать функции для:
  - Получения списка активных моделей из БД
  - Загрузки API-ключей из .env файла
  - Формирования запросов к разным типам API
  - Парсинга ответов от разных провайдеров
- [x] Реализовать функцию отправки промта во все активные модели

## Этап 5: Графический интерфейс (main.py)

- [x] Создать основной класс MainWindow на PyQt5
- [x] Реализовать интерфейс ввода промта:
  - Поле ввода нового промта
  - Выпадающий список/таблица для выбора сохранённых промтов
  - Кнопка отправки запроса
- [x] Реализовать интерфейс выбора моделей:
  - Список доступных моделей с чекбоксами для активации/деактивации
- [x] Реализовать таблицу результатов:
  - Колонки: название модели, текст ответа, чекбокс selected
  - Возможность прокрутки для длинных ответов
- [x] Реализовать кнопку "Сохранить" для сохранения выбранных результатов
- [x] Добавить меню и панели инструментов:
  - Управление моделями (добавление, редактирование)
  - Управление промтами (просмотр, редактирование, удаление)
  - Просмотр сохранённых результатов
  - Настройки программы
  - Экспорт результатов

## Этап 6: Интеграция компонентов

- [x] Подключить db.py к main.py
- [x] Интегрировать network.py и models.py для отправки запросов
- [x] Реализовать логику работы с временной таблицей результатов (в памяти)
- [x] Реализовать сохранение выбранных результатов в БД
- [x] Добавить обработку ошибок на уровне GUI
- [x] Реализовать индикаторы загрузки во время отправки запросов

## Этап 7: Дополнительные функции

- [x] Реализовать поиск и сортировку во всех таблицах интерфейса
- [x] Добавить экспорт результатов в Markdown
- [x] Добавить экспорт результатов в JSON
- [x] Реализовать логирование запросов в файл
- [x] Добавить настройки программы (сохранение в таблицу settings)
- [x] Реализовать управление тегами для промтов

## Этап 7.1: AI-ассистент для улучшения промтов

### 7.1.1: Подготовка модуля для улучшения промтов

- [x] Создать модуль `prompt_improver.py` для логики улучшения промтов
- [x] Реализовать функцию формирования системного промта для улучшения:
  - Шаблон запроса на улучшение промта
  - Шаблон запроса на генерацию альтернативных вариантов
  - Шаблон адаптации под разные типы задач (код, анализ, креатив)
- [x] Реализовать функцию парсинга ответа от AI:
  - Извлечение улучшенной версии промта
  - Извлечение альтернативных вариантов (2-3 штуки)
  - Извлечение адаптированных версий для разных типов задач

### 7.1.2: Интеграция с существующей системой API

- [x] Добавить метод в `models.py` для отправки запроса к одной модели (не ко всем)
- [x] Реализовать выбор модели для улучшения промтов:
  - Добавить настройку "Модель для улучшения промтов" в таблицу settings
  - Реализовать выбор модели из списка доступных в настройках
- [x] Использовать существующий OpenRouter-клиент из `network.py` для отправки запросов
- [x] Добавить обработку ошибок при улучшении промтов

### 7.1.3: Пользовательский интерфейс

- [x] Добавить кнопку "Улучшить промт" рядом с полем ввода промта в главном окне
- [x] Создать диалоговое окно `PromptImprovementDialog`:
  - Отображение исходного промта (read-only)
  - Вкладки или секции для:
    - Улучшенная версия
    - Альтернативные варианты (2-3 варианта)
    - Адаптированные версии (код, анализ, креатив)
  - Кнопки "Подставить в поле ввода" для каждого варианта
  - Кнопка "Закрыть"
- [x] Реализовать индикатор загрузки во время обработки запроса
- [x] Добавить возможность копирования текста улучшенных промтов в буфер обмена

### 7.1.4: Логика работы

- [x] При нажатии "Улучшить промт":
  - Проверить, что в поле ввода есть текст
  - Получить выбранную модель для улучшения из настроек
  - Отправить запрос к модели с системным промтом на улучшение
  - Отобразить результаты в диалоговом окне
- [x] Реализовать формирование системного промта:
  - Включить инструкции по улучшению промта
  - Указать формат ответа (JSON или структурированный текст)
  - Добавить примеры хороших улучшений
- [x] Реализовать обработку ответа:
  - Парсинг JSON-ответа (если модель возвращает JSON)
  - Или парсинг структурированного текста
  - Извлечение улучшенной версии и альтернатив
- [x] При нажатии "Подставить в поле ввода":
  - Заменить текст в поле ввода промта на выбранный вариант
  - Закрыть диалоговое окно

### 7.1.5: Настройки и конфигурация

- [x] Добавить в таблицу settings:
  - `prompt_improver_model` - ID модели для улучшения промтов
  - `prompt_improver_enabled` - включен ли ассистент (по умолчанию true)
- [x] Добавить в окно настроек:
  - Выбор модели для улучшения промтов из списка доступных
  - Чекбокс включения/выключения функции
- [x] Сохранять настройки в БД при изменении

### 7.1.6: Обработка ошибок и edge cases

- [x] Обработка случая, когда модель не выбрана в настройках
- [x] Обработка ошибок API при запросе улучшения
- [x] Обработка некорректного формата ответа от модели
- [x] Добавить fallback на обычный текст, если JSON-парсинг не удался
- [x] Показывать понятные сообщения об ошибках пользователю

### 7.1.7: Тестирование и оптимизация

- [ ] Протестировать улучшение промтов с разными моделями
- [ ] Проверить работу с разными типами промтов (короткие, длинные, технические, креативные)
- [ ] Оптимизировать системные промты для лучших результатов
- [ ] Проверить производительность (таймауты, скорость ответа)
- [ ] Протестировать UI на удобство использования

## Этап 8: Тестирование и оптимизация

- [ ] Протестировать работу с разными API провайдерами
- [ ] Проверить обработку ошибок (недоступность API, неверные ключи и т.д.)
- [ ] Оптимизировать производительность при работе с большим количеством моделей
- [ ] Проверить работу с большими объёмами данных в БД
- [ ] Исправить найденные баги

## Этап 9: Документация и финализация

- [x] Создать README.md с инструкциями по установке и использованию
- [x] Добавить комментарии в код
- [x] Создать примеры конфигурации .env файла
- [x] Подготовить проект к сборке исполняемого файла (PyInstaller)
